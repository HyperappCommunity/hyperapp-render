{"version":3,"file":"hyperapp-render.min.js","sources":["../src/index.js"],"sourcesContent":["const cache = new Map();\nconst uppercasePattern = /([A-Z])/g;\nconst msPattern = /^ms-/;\n\n// https://www.w3.org/TR/html/syntax.html#void-elements\nconst voidElements = new Set([\n  'area',\n  'base',\n  'br',\n  'col',\n  'embed',\n  'hr',\n  'img',\n  'input',\n  'link',\n  'meta',\n  'param',\n  'source',\n  'track',\n  'wbr',\n]);\n\n// https://www.w3.org/International/questions/qa-escapes#use\nconst escapeRegExp = /[\"&'<>]/g;\nconst escapeLookup = new Map([\n  ['\"', '&quot;'],\n  ['&', '&amp;'],\n  [\"'\", '&#39;'],\n  ['<', '&lt;'],\n  ['>', '&gt;'],\n]);\n\nfunction escaper(match) {\n  return escapeLookup.get(match);\n}\n\nfunction escapeHtml(value) {\n  return String(value).replace(escapeRegExp, escaper);\n}\n\n// \"backgroundColor\" => \"background-color\"\n// \"MozTransition\" => \"-moz-transition\"\n// \"msTransition\" => \"-ms-transition\"\nfunction hyphenateStyleName(styleName) {\n  if (!cache.has(styleName)) {\n    cache.set(styleName, styleName\n      .replace(uppercasePattern, '-$&')\n      .toLowerCase()\n      .replace(msPattern, '-ms-'));\n  }\n  return cache.get(styleName);\n}\n\nfunction stringifyStyles(styles) {\n  let serialized = '';\n  let delimiter = '';\n  const styleNames = Object.keys(styles);\n  for (let i = 0, len = styleNames.length; i < len; i++) {\n    const styleName = styleNames[i];\n    const styleValue = styles[styleName];\n\n    // keep in sync with https://github.com/hyperapp/hyperapp/blob/1.0.2/src/index.js#L134\n    if (styleValue != null) {\n      serialized += delimiter + hyphenateStyleName(styleName) + ':' + styleValue;\n      delimiter = ';';\n    }\n  }\n  return serialized || null;\n}\n\nfunction renderAttribute(name, value) {\n  let val = value;\n  if (name === 'style' && val) {\n    val = stringifyStyles(val);\n  }\n  if (val == null || val === false) {\n    return '';\n  }\n  if (val === true) {\n    return name;\n  }\n  return name + '=\"' + escapeHtml(val) + '\"';\n}\n\nfunction renderFragment(node, stack) {\n  // keep in sync with https://github.com/hyperapp/hyperapp/blob/1.0.2/src/index.js#L149\n  if (node == null) {\n    return '';\n  }\n\n  const props = node.props;\n  if (!props) { // text node\n    return escapeHtml(node);\n  }\n\n  const tag = node.name;\n  let out = '';\n  let footer = '';\n  if (tag) {\n    // https://www.w3.org/TR/html51/syntax.html#serializing-html-fragments\n    out += '<' + tag;\n    const propNames = Object.keys(props);\n    for (let i = 0, len = propNames.length; i < len; i++) {\n      const name = propNames[i];\n      const value = props[name];\n\n      // keep in sync with https://github.com/hyperapp/hyperapp/blob/1.0.2/src/index.js#L130\n      if (name !== 'key' && name !== 'innerHTML' && typeof value !== 'function') {\n        const attr = renderAttribute(name, value);\n        if (attr) {\n          out += ' ' + attr;\n        }\n      }\n    }\n\n    if (voidElements.has(tag)) {\n      out += '/>';\n    } else {\n      out += '>';\n      footer = '</' + tag + '>';\n    }\n  }\n\n  const html = props.innerHTML;\n  if (html != null) {\n    out += html;\n  }\n\n  const children = node.children;\n  if (children.length > 0) {\n    stack.push({\n      childIndex: 0,\n      children,\n      footer,\n    });\n  } else {\n    out += footer;\n  }\n\n  return out;\n}\n\nexport function renderer(node) {\n  const stack = [{\n    childIndex: 0,\n    children: [node],\n    footer: '',\n  }];\n  let end = false;\n  return (bytes) => {\n    if (end) {\n      return null;\n    }\n    let out = '';\n    while (out.length < bytes) {\n      if (stack.length === 0) {\n        end = true;\n        break;\n      }\n      const frame = stack[stack.length - 1];\n      if (frame.childIndex >= frame.children.length) {\n        out += frame.footer;\n        stack.pop();\n      } else {\n        const child = frame.children[frame.childIndex++];\n        out += renderFragment(child, stack);\n      }\n    }\n    return out;\n  };\n}\n\nexport function renderToString(node) {\n  return renderer(node)(Infinity);\n}\n\nexport function render(app) {\n  return (initialState, actionsTemplate, view, container) =>\n    app(\n      initialState,\n      Object.assign(\n        {},\n        actionsTemplate,\n        {\n          toString: () => (state, actions) => renderToString(view(state, actions)),\n        },\n      ),\n      view,\n      container,\n    );\n}\n"],"names":["cache","Map","uppercasePattern","msPattern","voidElements","Set","escapeRegExp","escapeLookup","escaper","match","get","escapeHtml","value","String","replace","renderAttribute","name","val","styles","styleName","serialized","delimiter","styleNames","Object","keys","i","len","length","styleValue","has","set","toLowerCase","stringifyStyles","renderFragment","node","stack","props","tag","out","footer","propNames","attr","html","innerHTML","children","push","renderer","end","bytes","frame","childIndex","pop","renderToString","Infinity","app","initialState","actionsTemplate","view","container","assign","state","actions"],"mappings":";0BAAA,IAAMA,EAAQ,IAAIC,IACZC,EAAmB,WACnBC,EAAY,OAGZC,EAAe,IAAIC,KACvB,OACA,OACA,KACA,MACA,QACA,KACA,MACA,QACA,OACA,OACA,QACA,SACA,QACA,QAIIC,EAAe,WACfC,EAAe,IAAIN,MACtB,IAAK,WACL,IAAK,UACL,IAAK,UACL,IAAK,SACL,IAAK,UAGR,SAASO,EAAQC,UACRF,EAAaG,IAAID,GAG1B,SAASE,EAAWC,UACXC,OAAOD,GAAOE,QAAQR,EAAcE,GAiC7C,SAASO,EAAgBC,EAAMJ,OACzBK,EAAML,QACG,UAATI,GAAoBC,MAnB1B,SAAyBC,WAVGC,EAWtBC,EAAa,GACbC,EAAY,GACVC,EAAaC,OAAOC,KAAKN,GACtBO,EAAI,EAAGC,EAAMJ,EAAWK,OAAQF,EAAIC,EAAKD,IAAK,KAC/CN,EAAYG,EAAWG,GACvBG,EAAaV,EAAOC,GAGR,MAAdS,OACYP,GApBQF,EAoBuBA,EAnB5CnB,EAAM6B,IAAIV,MACPW,IAAIX,EAAWA,EAClBL,QAAQZ,EAAkB,OAC1B6B,cACAjB,QAAQX,EAAW,SAEjBH,EAAMU,IAAIS,IAa6C,IAAMS,IACpD,YAGTR,GAAc,KAMbY,CAAgBf,IAEb,MAAPA,IAAuB,IAARA,EACV,IAEG,IAARA,EACKD,EAEFA,EAAO,KAAOL,EAAWM,GAAO,IAGzC,SAASgB,EAAeC,EAAMC,MAEhB,MAARD,QACK,OAGHE,EAAQF,EAAKE,UACdA,SACIzB,EAAWuB,OAGdG,EAAMH,EAAKlB,KACbsB,EAAM,GACNC,EAAS,MACTF,EAAK,IAEA,IAAMA,UACPG,EAAYjB,OAAOC,KAAKY,GACrBX,EAAI,EAAGC,EAAMc,EAAUb,OAAQF,EAAIC,EAAKD,IAAK,KAC9CT,EAAOwB,EAAUf,GACjBb,EAAQwB,EAAMpB,MAGP,QAATA,GAA2B,cAATA,GAAyC,mBAAVJ,EAAsB,KACnE6B,EAAO1B,EAAgBC,EAAMJ,GAC/B6B,OACK,IAAMA,IAKfrC,EAAayB,IAAIQ,MACZ,SAEA,MACE,KAAOA,EAAM,SAIpBK,EAAON,EAAMO,UACP,MAARD,OACKA,OAGHE,EAAWV,EAAKU,gBAClBA,EAASjB,OAAS,IACdkB,iBACQ,2BAKPN,EAGFD,EAGT,SAAgBQ,EAASZ,OACjBC,eACQ,YACDD,UACH,KAENa,GAAM,SACH,SAACC,MACFD,SACK,aAELT,EAAM,GACHA,EAAIX,OAASqB,GAAO,IACJ,IAAjBb,EAAMR,OAAc,IAChB,YAGFsB,EAAQd,EAAMA,EAAMR,OAAS,MAC/BsB,EAAMC,YAAcD,EAAML,SAASjB,UAC9BsB,EAAMV,SACPY,cAGClB,EADOgB,EAAML,SAASK,EAAMC,cACNf,UAG1BG,GAIX,SAAgBc,EAAelB,UACtBY,EAASZ,EAATY,CAAeO,EAAAA,4CAGxB,SAAuBC,UACd,SAACC,EAAcC,EAAiBC,EAAMC,UAC3CJ,EACEC,EACAhC,OAAOoC,UAELH,YAEY,kBAAM,SAACI,EAAOC,UAAYT,EAAeK,EAAKG,EAAOC,QAGnEJ,EACAC"}