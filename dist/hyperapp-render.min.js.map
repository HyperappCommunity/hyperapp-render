{"version":3,"file":"hyperapp-render.min.js","sources":["src/index.js","src/browser.js"],"sourcesContent":["const styleNameCache = new Map()\nconst uppercasePattern = /([A-Z])/g\nconst msPattern = /^ms-/\n\n// https://www.w3.org/TR/html/syntax.html#void-elements\nconst voidElements = new Set([\n  'area',\n  'base',\n  'br',\n  'col',\n  'embed',\n  'hr',\n  'img',\n  'input',\n  'link',\n  'meta',\n  'param',\n  'source',\n  'track',\n  'wbr',\n])\n\nconst ignoreAttributes = new Set([\n  'key',\n  'innerHTML',\n  '__source', // https://babeljs.io/docs/plugins/transform-react-jsx-source/\n])\n\n// https://www.w3.org/International/questions/qa-escapes#use\nconst escapeRegExp = /[\"&'<>]/g\nconst escapeLookup = new Map([\n  ['\"', '&quot;'],\n  ['&', '&amp;'],\n  [\"'\", '&#39;'], // shorter than \"&apos;\" and \"&#x27;\" plus supports HTML4\n  ['<', '&lt;'],\n  ['>', '&gt;'],\n])\n\nfunction escaper(match) {\n  return escapeLookup.get(match)\n}\n\nfunction escapeHtml(value) {\n  if (typeof value === 'number') {\n    // better performance for safe values\n    return '' + value\n  }\n\n  return ('' + value).replace(escapeRegExp, escaper)\n}\n\n// \"backgroundColor\" => \"background-color\"\n// \"MozTransition\" => \"-moz-transition\"\n// \"msTransition\" => \"-ms-transition\"\nfunction hyphenateStyleName(styleName) {\n  return (\n    styleNameCache.get(styleName) ||\n    styleNameCache\n      .set(\n        styleName,\n        styleName\n          .replace(uppercasePattern, '-$&')\n          .toLowerCase()\n          .replace(msPattern, '-ms-'),\n      )\n      .get(styleName)\n  )\n}\n\nfunction stringifyStyles(styles) {\n  let out = ''\n  let delimiter = ''\n  const styleNames = Object.keys(styles)\n\n  for (let i = 0; i < styleNames.length; i++) {\n    const styleName = styleNames[i]\n    const styleValue = styles[styleName]\n\n    if (styleValue != null) {\n      if (styleName === 'cssText') {\n        out += delimiter + styleValue\n      } else {\n        out += delimiter + hyphenateStyleName(styleName) + ':' + styleValue\n      }\n\n      delimiter = ';'\n    }\n  }\n\n  return out || null\n}\n\n// https://www.w3.org/TR/html51/syntax.html#serializing-html-fragments\nfunction renderFragment({ nodeName, attributes, children }, stack) {\n  let out = ''\n  let footer = ''\n\n  if (nodeName) {\n    out += '<' + nodeName\n    const keys = Object.keys(attributes)\n\n    for (let i = 0; i < keys.length; i++) {\n      const name = keys[i]\n      let value = attributes[name]\n\n      if (name === 'style' && value && typeof value === 'object') {\n        value = stringifyStyles(value)\n      }\n\n      if (\n        value != null &&\n        value !== false &&\n        typeof value !== 'function' &&\n        !ignoreAttributes.has(name)\n      ) {\n        out += ' ' + name\n\n        if (value !== true) {\n          out += '=\"' + escapeHtml(value) + '\"'\n        }\n      }\n    }\n\n    if (voidElements.has(nodeName)) {\n      out += '/>'\n    } else {\n      out += '>'\n      footer = '</' + nodeName + '>'\n    }\n  }\n\n  const { innerHTML } = attributes\n\n  if (innerHTML != null) {\n    out += innerHTML\n  }\n\n  if (children.length > 0) {\n    stack.push({\n      childIndex: 0,\n      children,\n      footer,\n    })\n  } else {\n    out += footer\n  }\n\n  return out\n}\n\nfunction resolveNode(node, state, actions) {\n  if (typeof node === 'function') {\n    return resolveNode(node(state, actions), state, actions)\n  }\n\n  return node\n}\n\nexport function renderer(view, state, actions) {\n  const stack = [\n    {\n      childIndex: 0,\n      children: [view],\n      footer: '',\n    },\n  ]\n  let end = false\n  return (bytes) => {\n    if (end) {\n      return null\n    }\n\n    let out = ''\n\n    while (out.length < bytes) {\n      if (stack.length === 0) {\n        end = true\n        break\n      }\n\n      const frame = stack[stack.length - 1]\n\n      if (frame.childIndex >= frame.children.length) {\n        out += frame.footer\n        stack.pop()\n      } else {\n        const node = resolveNode(frame.children[frame.childIndex++], state, actions)\n\n        if (node != null && typeof node !== 'boolean') {\n          if (node.pop) {\n            // array\n            stack.push({\n              childIndex: 0,\n              children: node,\n              footer: '',\n            })\n          } else if (node.attributes) {\n            // element\n            out += renderFragment(node, stack)\n          } else {\n            // text node\n            out += escapeHtml(node)\n          }\n        }\n      }\n    }\n\n    return out\n  }\n}\n\nexport function renderToString(view, state, actions) {\n  return renderer(view, state, actions)(Infinity)\n}\n","import { renderToString } from './index'\n\nexport { renderToString }\n\nexport function withRender(nextApp) {\n  return (initialState, actionsTemplate, view, container) => {\n    const actions = nextApp(\n      initialState,\n      { ...actionsTemplate, getState: () => (state) => state },\n      view,\n      container,\n    )\n\n    actions.toString = () => renderToString(view, actions.getState(), actions)\n\n    return actions\n  }\n}\n"],"names":["styleNameCache","Map","uppercasePattern","msPattern","voidElements","Set","ignoreAttributes","escapeRegExp","escapeLookup","escaper","match","get","escapeHtml","value","replace","stringifyStyles","styles","styleName","out","delimiter","styleNames","Object","keys","i","length","styleValue","set","toLowerCase","renderFragment","stack","nodeName","attributes","children","footer","name","has","innerHTML","push","childIndex","resolveNode","node","state","actions","renderToString","view","end","bytes","frame","pop","renderer","Infinity","nextApp","initialState","actionsTemplate","container","getState","toString"],"mappings":"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"}