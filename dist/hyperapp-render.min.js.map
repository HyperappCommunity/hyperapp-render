{"version":3,"file":"hyperapp-render.min.js","sources":["src/index.js"],"sourcesContent":["const styleNameCache = new Map()\nconst uppercasePattern = /([A-Z])/g\nconst msPattern = /^ms-/\n\n// https://www.w3.org/TR/html/syntax.html#void-elements\nconst voidElements = new Set([\n  'area',\n  'base',\n  'br',\n  'col',\n  'embed',\n  'hr',\n  'img',\n  'input',\n  'link',\n  'meta',\n  'param',\n  'source',\n  'track',\n  'wbr',\n])\n\nconst ignoreAttributes = new Set([\n  'key',\n  'innerHTML',\n  '__source', // https://babeljs.io/docs/plugins/transform-react-jsx-source/\n])\n\n// https://www.w3.org/International/questions/qa-escapes#use\nconst escapeRegExp = /[\"&'<>]/g\nconst escapeLookup = new Map([\n  ['\"', '&quot;'],\n  ['&', '&amp;'],\n  [\"'\", '&#39;'],\n  ['<', '&lt;'],\n  ['>', '&gt;'],\n])\n\nfunction escaper(match) {\n  return escapeLookup.get(match)\n}\n\nfunction escapeHtml(value) {\n  if (typeof value === 'number') {\n    // better performance for safe values\n    return '' + value\n  }\n  return ('' + value).replace(escapeRegExp, escaper)\n}\n\n// \"backgroundColor\" => \"background-color\"\n// \"MozTransition\" => \"-moz-transition\"\n// \"msTransition\" => \"-ms-transition\"\nfunction hyphenateStyleName(styleName) {\n  return (\n    styleNameCache.get(styleName) ||\n    styleNameCache\n      .set(\n        styleName,\n        styleName\n          .replace(uppercasePattern, '-$&')\n          .toLowerCase()\n          .replace(msPattern, '-ms-'),\n      )\n      .get(styleName)\n  )\n}\n\nfunction stringifyStyles(styles) {\n  let serialized = ''\n  let delimiter = ''\n  const styleNames = Object.keys(styles)\n  for (let i = 0, len = styleNames.length; i < len; i++) {\n    const styleName = styleNames[i]\n    const styleValue = styles[styleName]\n\n    // keep in sync with https://github.com/hyperapp/hyperapp/blob/1.1.2/src/index.js#L135\n    if (styleValue != null) {\n      if (styleName === 'cssText') {\n        serialized += delimiter + styleValue\n      } else {\n        serialized += delimiter + hyphenateStyleName(styleName) + ':' + styleValue\n      }\n      delimiter = ';'\n    }\n  }\n  return serialized || null\n}\n\nfunction renderFragment(node, stack) {\n  // keep in sync with https://github.com/hyperapp/hyperapp/blob/1.1.2/src/index.js#L150\n  if (node == null || typeof node === 'boolean') {\n    return ''\n  }\n\n  const { attributes } = node\n  if (!attributes) {\n    // text node\n    return escapeHtml(node)\n  }\n\n  const tag = node.nodeName\n  let out = ''\n  let footer = ''\n  if (tag) {\n    // https://www.w3.org/TR/html51/syntax.html#serializing-html-fragments\n    out += '<' + tag\n    const keys = Object.keys(attributes)\n    for (let i = 0, len = keys.length; i < len; i++) {\n      const name = keys[i]\n      let value = attributes[name]\n\n      if (name === 'style' && value && typeof value === 'object') {\n        value = stringifyStyles(value)\n      }\n\n      // keep in sync with https://github.com/hyperapp/hyperapp/blob/1.1.2/src/index.js#L131\n      if (\n        value != null &&\n        value !== false &&\n        typeof value !== 'function' &&\n        !ignoreAttributes.has(name)\n      ) {\n        out += ' ' + name\n        if (value !== true) {\n          out += '=\"' + escapeHtml(value) + '\"'\n        }\n      }\n    }\n\n    if (voidElements.has(tag)) {\n      out += '/>'\n    } else {\n      out += '>'\n      footer = '</' + tag + '>'\n    }\n  }\n\n  const { innerHTML } = attributes\n  if (innerHTML != null) {\n    out += innerHTML\n  }\n\n  const { children } = node\n  if (children.length > 0) {\n    stack.push({\n      childIndex: 0,\n      children,\n      footer,\n    })\n  } else {\n    out += footer\n  }\n\n  return out\n}\n\nexport function renderer(node) {\n  const stack = [\n    {\n      childIndex: 0,\n      children: [node],\n      footer: '',\n    },\n  ]\n  let end = false\n  return (bytes) => {\n    if (end) {\n      return null\n    }\n    let out = ''\n    while (out.length < bytes) {\n      if (stack.length === 0) {\n        end = true\n        break\n      }\n      const frame = stack[stack.length - 1]\n      if (frame.childIndex >= frame.children.length) {\n        out += frame.footer\n        stack.pop()\n      } else {\n        const child = frame.children[frame.childIndex++]\n        out += renderFragment(child, stack)\n      }\n    }\n    return out\n  }\n}\n\nexport function renderToString(node) {\n  return renderer(node)(Infinity)\n}\n\nexport function render(app) {\n  return (initialState, actionsTemplate, view, container) =>\n    app(\n      initialState,\n      Object.assign({}, actionsTemplate, {\n        toString: () => (state, actions) => renderToString(view(state, actions)),\n      }),\n      view,\n      container,\n    )\n}\n"],"names":["styleNameCache","Map","uppercasePattern","msPattern","voidElements","Set","ignoreAttributes","escapeRegExp","escapeLookup","escaper","match","get","escapeHtml","value","replace","hyphenateStyleName","styleName","set","toLowerCase","stringifyStyles","styles","serialized","delimiter","styleNames","Object","keys","i","len","length","styleValue","renderFragment","node","stack","attributes","tag","nodeName","out","footer","name","has","innerHTML","children","push","renderer","end","bytes","frame","childIndex","pop","renderToString","Infinity","app","initialState","actionsTemplate","view","container","assign","state","actions"],"mappings":";+LAAA,IAAMA,EAAiB,IAAIC,IACrBC,EAAmB,WACnBC,EAAY,OAGZC,EAAe,IAAIC,KACvB,OACA,OACA,KACA,MACA,QACA,KACA,MACA,QACA,OACA,OACA,QACA,SACA,QACA,QAGIC,EAAmB,IAAID,KAC3B,MACA,YACA,aAIIE,EAAe,WACfC,EAAe,IAAIP,MACtB,IAAK,WACL,IAAK,UACL,IAAK,UACL,IAAK,SACL,IAAK,UAGR,SAASQ,EAAQC,UACRF,EAAaG,IAAID,GAG1B,SAASE,EAAWC,SACG,iBAAVA,EAEF,GAAKA,GAEN,GAAKA,GAAOC,QAAQP,EAAcE,GAM5C,SAASM,EAAmBC,UAExBhB,EAAeW,IAAIK,IACnBhB,EACGiB,IACCD,EACAA,EACGF,QAAQZ,EAAkB,OAC1BgB,cACAJ,QAAQX,EAAW,SAEvBQ,IAAIK,GAIX,SAASG,EAAgBC,WACnBC,EAAa,GACbC,EAAY,GACVC,EAAaC,OAAOC,KAAKL,GACtBM,EAAI,EAAGC,EAAMJ,EAAWK,OAAQF,EAAIC,EAAKD,IAAK,KAC/CV,EAAYO,EAAWG,GACvBG,EAAaT,EAAOJ,GAGR,MAAda,OACgB,YAAdb,EACYM,EAAYO,EAEZP,EAAYP,EAAmBC,GAAa,IAAMa,IAEtD,YAGTR,GAAc,KAGvB,SAASS,EAAeC,EAAMC,MAEhB,MAARD,GAAgC,kBAATA,QAClB,OAGDE,EAAeF,EAAfE,eACHA,SAEIrB,EAAWmB,OAGdG,EAAMH,EAAKI,SACbC,EAAM,GACNC,EAAS,MACTH,EAAK,IAEA,IAAMA,UACPT,EAAOD,OAAOC,KAAKQ,GAChBP,EAAI,EAAGC,EAAMF,EAAKG,OAAQF,EAAIC,EAAKD,IAAK,KACzCY,EAAOb,EAAKC,GACdb,EAAQoB,EAAWK,GAEV,UAATA,GAAoBzB,GAA0B,iBAAVA,MAC9BM,EAAgBN,IAKf,MAATA,IACU,IAAVA,GACiB,mBAAVA,GACNP,EAAiBiC,IAAID,QAEf,IAAMA,GACC,IAAVzB,OACK,KAAOD,EAAWC,GAAS,MAKpCT,EAAamC,IAAIL,MACZ,SAEA,MACE,KAAOA,EAAM,SAIlBM,EAAcP,EAAdO,UACS,MAAbA,OACKA,OAGDC,EAAaV,EAAbU,gBACJA,EAASb,OAAS,IACdc,iBACQ,2BAKPL,EAGFD,EAGT,SAAgBO,EAASZ,OACjBC,eAEU,YACDD,UACH,KAGRa,GAAM,SACH,SAACC,MACFD,SACK,aAELR,EAAM,GACHA,EAAIR,OAASiB,GAAO,IACJ,IAAjBb,EAAMJ,OAAc,IAChB,YAGFkB,EAAQd,EAAMA,EAAMJ,OAAS,MAC/BkB,EAAMC,YAAcD,EAAML,SAASb,UAC9BkB,EAAMT,SACPW,cAGClB,EADOgB,EAAML,SAASK,EAAMC,cACNf,UAG1BI,GAIX,SAAgBa,EAAelB,UACtBY,EAASZ,EAATY,CAAeO,EAAAA,4CAGxB,SAAuBC,UACd,SAACC,EAAcC,EAAiBC,EAAMC,UAC3CJ,EACEC,EACA5B,OAAOgC,UAAWH,YACN,kBAAM,SAACI,EAAOC,UAAYT,EAAeK,EAAKG,EAAOC,QAEjEJ,EACAC"}