{"version":3,"file":"hyperapp-render.js","sources":["src/index.js","src/browser.js"],"sourcesContent":["const styleNameCache = new Map()\nconst uppercasePattern = /([A-Z])/g\nconst msPattern = /^ms-/\n\n// https://www.w3.org/TR/html/syntax.html#void-elements\nconst voidElements = new Set([\n  'area',\n  'base',\n  'br',\n  'col',\n  'embed',\n  'hr',\n  'img',\n  'input',\n  'link',\n  'meta',\n  'param',\n  'source',\n  'track',\n  'wbr',\n])\n\nconst ignoreAttributes = new Set([\n  'key',\n  'innerHTML',\n  '__source', // https://babeljs.io/docs/plugins/transform-react-jsx-source/\n])\n\n// https://www.w3.org/International/questions/qa-escapes#use\nconst escapeRegExp = /[\"&'<>]/g\nconst escapeLookup = new Map([\n  ['\"', '&quot;'],\n  ['&', '&amp;'],\n  [\"'\", '&#39;'], // shorter than \"&apos;\" and \"&#x27;\" plus supports HTML4\n  ['<', '&lt;'],\n  ['>', '&gt;'],\n])\n\nfunction escaper(match) {\n  return escapeLookup.get(match)\n}\n\nfunction escapeHtml(value) {\n  if (typeof value === 'number') {\n    // better performance for safe values\n    return '' + value\n  }\n\n  return ('' + value).replace(escapeRegExp, escaper)\n}\n\n// \"backgroundColor\" => \"background-color\"\n// \"MozTransition\" => \"-moz-transition\"\n// \"msTransition\" => \"-ms-transition\"\nfunction hyphenateStyleName(styleName) {\n  return (\n    styleNameCache.get(styleName) ||\n    styleNameCache\n      .set(\n        styleName,\n        styleName\n          .replace(uppercasePattern, '-$&')\n          .toLowerCase()\n          .replace(msPattern, '-ms-'),\n      )\n      .get(styleName)\n  )\n}\n\nfunction stringifyStyles(styles) {\n  let out = ''\n  let delimiter = ''\n  const styleNames = Object.keys(styles)\n\n  for (let i = 0; i < styleNames.length; i++) {\n    const styleName = styleNames[i]\n    const styleValue = styles[styleName]\n\n    if (styleValue != null) {\n      if (styleName === 'cssText') {\n        out += delimiter + styleValue\n      } else {\n        out += delimiter + hyphenateStyleName(styleName) + ':' + styleValue\n      }\n\n      delimiter = ';'\n    }\n  }\n\n  return out || null\n}\n\n// https://www.w3.org/TR/html51/syntax.html#serializing-html-fragments\nfunction renderFragment({ nodeName, attributes, children }, stack) {\n  let out = ''\n  let footer = ''\n\n  if (nodeName) {\n    out += '<' + nodeName\n    const keys = Object.keys(attributes)\n\n    for (let i = 0; i < keys.length; i++) {\n      const name = keys[i]\n      let value = attributes[name]\n\n      if (name === 'style' && value && typeof value === 'object') {\n        value = stringifyStyles(value)\n      }\n\n      if (\n        value != null &&\n        value !== false &&\n        typeof value !== 'function' &&\n        !ignoreAttributes.has(name)\n      ) {\n        out += ' ' + name\n\n        if (value !== true) {\n          out += '=\"' + escapeHtml(value) + '\"'\n        }\n      }\n    }\n\n    if (voidElements.has(nodeName)) {\n      out += '/>'\n    } else {\n      out += '>'\n      footer = '</' + nodeName + '>'\n    }\n  }\n\n  const { innerHTML } = attributes\n\n  if (innerHTML != null) {\n    out += innerHTML\n  }\n\n  if (children.length > 0) {\n    stack.push({\n      childIndex: 0,\n      children,\n      footer,\n    })\n  } else {\n    out += footer\n  }\n\n  return out\n}\n\nfunction resolveNode(node, state, actions) {\n  if (typeof node === 'function') {\n    return resolveNode(node(state, actions), state, actions)\n  }\n\n  return node\n}\n\nexport function renderer(view, state, actions) {\n  const stack = [\n    {\n      childIndex: 0,\n      children: [view],\n      footer: '',\n    },\n  ]\n  let end = false\n  return (bytes) => {\n    if (end) {\n      return null\n    }\n\n    let out = ''\n\n    while (out.length < bytes) {\n      if (stack.length === 0) {\n        end = true\n        break\n      }\n\n      const frame = stack[stack.length - 1]\n\n      if (frame.childIndex >= frame.children.length) {\n        out += frame.footer\n        stack.pop()\n      } else {\n        const node = resolveNode(frame.children[frame.childIndex++], state, actions)\n\n        if (node != null && typeof node !== 'boolean') {\n          if (node.pop) {\n            // array\n            stack.push({\n              childIndex: 0,\n              children: node,\n              footer: '',\n            })\n          } else if (node.attributes) {\n            // element\n            out += renderFragment(node, stack)\n          } else {\n            // text node\n            out += escapeHtml(node)\n          }\n        }\n      }\n    }\n\n    return out\n  }\n}\n\nexport function renderToString(view, state, actions) {\n  return renderer(view, state, actions)(Infinity)\n}\n","import { renderToString } from './index'\n\nexport { renderToString }\n\nexport function withRender(nextApp) {\n  return (initialState, actionsTemplate, view, container) => {\n    const actions = nextApp(\n      initialState,\n      { ...actionsTemplate, getState: () => (state) => state },\n      view,\n      container,\n    )\n\n    actions.toString = () => renderToString(view, actions.getState(), actions)\n\n    return actions\n  }\n}\n"],"names":["styleNameCache","Map","uppercasePattern","msPattern","voidElements","Set","ignoreAttributes","escapeRegExp","escapeLookup","escaper","match","get","escapeHtml","value","replace","hyphenateStyleName","styleName","set","toLowerCase","stringifyStyles","styles","out","delimiter","styleNames","Object","keys","i","length","styleValue","renderFragment","stack","nodeName","attributes","children","footer","name","has","innerHTML","push","childIndex","resolveNode","node","state","actions","renderer","view","end","bytes","frame","pop","renderToString","Infinity","withRender","nextApp","initialState","actionsTemplate","container","getState","toString"],"mappings":"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"}